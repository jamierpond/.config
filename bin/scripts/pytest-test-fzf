#!/bin/zsh
# Fuzzy select and run a pytest test

tests=$(rg -N "^\s*def test_" ./tests/ --no-filename | sed 's/^\s*//' | awk -F'[( ]' '{print $2}')
to_run=$(echo "$tests" | fzf)

if [ -z "$to_run" ]; then
  echo "No test selected"
  exit 0
fi

cmd="python -m pytest -s -k $to_run"
echo "$cmd"
print -s "$cmd" 2>/dev/null
eval "$cmd"
