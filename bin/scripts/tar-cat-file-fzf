#!/bin/zsh
# Cat a file from a tarball (select with fzf)

tar_file="$1"

if [ -z "$tar_file" ]; then
  echo "Usage: tar-cat-file-fzf <tarfile>"
  exit 1
fi

if [ ! -f "$tar_file" ]; then
  echo "File '$tar_file' does not exist"
  exit 1
fi

file=$(tar -tvf "$tar_file" | awk '{ print $6 }' | fzf)

if [ -z "$file" ]; then
  exit 0
fi

cmd="tar -xOf '$tar_file' '$file'"
print -s "$cmd" 2>/dev/null
eval "$cmd"
